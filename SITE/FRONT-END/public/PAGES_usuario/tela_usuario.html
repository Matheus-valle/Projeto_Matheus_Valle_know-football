<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/tela_usuario.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
    <link rel="icon" href="../assets/bola_icon.png" type="image/x-icon">
    <title>tela home</title>
</head>

<body onload=" obterDadosGraficoMetricasCadastradas(), mostrar_posição_usuario()">
    <header>
        <div class="logo">
            <img onclick="home()" src="../assets/LOGO-removebg-preview.png" alt="img">
        </div>
        <div class="mensagem_usuario" id="mensagem_usuario">

        </div>
    </header>

    <div class="pagina_total">
        <div class="nav_bar">
            <p>PAGINAS</p>

            <button><a href="tela_usuario.html">HOME</a></button>
            <button><a href="tela_times.html">SELETIVAS</a></button>

        </div>

        <div class="lista">
            <div class="posição">
                <div class="textos">
                    <p>SEUS DADOS ESTÃO SENDO </p>
                    <p> COMPUTADOS PARA A POSIÇÃO:</p>
                    <p id="p_posicao" style="color: yellow;"></p>
                </div>
                <div id="img_usuario">


                </div>

            </div>
            <div class="dashboard">
                <div class="titulo">
                    <h1>SUAS ULTIMAS PROJEÇÕES / RESULTADOS:</h1>
                </div>
                <div class="card_dashboard">
                    <div class="titulo_dashboard">
                        <h1>TIRO 40Y</h1>
                    </div>

                    <div class="KPIS">
                        <div class="KPI_1">
                            <p style="font-size: 15px;">TAXA DE REDUÇÃO DE TEMPO:</p>
                            <div class="KP1_TEMPO">
                                <p>2/3 SEGS</p>
                            </div>
                        </div>
                        <div class="KPI_2">
                            <p style="font-size: 15px;">EVOULUÇÃO PARA O FUTEBOL AMERICANO</p>
                            <div class="KP2_FUTEBOL">
                                <p>MÉDIA</p>
                            </div>
                        </div>
                        <div class="KPI_3">
                            <p style="font-size: 15px;">GANHO DE TEMPO:</p>
                            <div class="KP3_GANHO">
                                <p>10 SEGS</p>
                            </div>
                        </div>
                    </div>
                    <div class="calculo">
                        <p style="font-size: 20px;">CALCULO UTILIZADO PARA AS METRICAS: <span style="color: rgb(77, 100, 140);">PROJEÇÃO MÊS = FREQUENCIA * TEMPO ATUAL / 100</span> </p>
                    </div>

                    <div class="card">
                        <canvas id="myChart"></canvas>
                    </div>

                    <div class="registros">
                        <div class="inputs">
                            <div class="input1">
                                <p>DIGITE O MÊS:</p>
                                <input type="number" id="Input_mes">
                            </div>
                            <div class="input2">
                                <p>DIGITE O TEMPO:</p>
                                <input type="number" id="input_tempo">
                            </div>
                        </div>
                        <div class="botões_registro">
                            <div class="botão01">
                                <p>CADASTRAR:</p>
                                <button>CADASTRO</button>
                            </div>
                            <div class="input2">
                                <p>EDITAR:</p>
                                <button>EDITAR</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    mensagem_usuario.innerHTML = `<h1>OLÁ ${sessionStorage.NOME_USUARIO}</h1>`

    function home() {
        window.location = "../index.html"
    }

    function cadastrar_metrica_tiro40y() {
       var mes =  Number(Input_mes.value)
       var tempo = Number(input_tempo.value)  
    }

    function mostrar_posição_usuario() {


        var peso = parseFloat(sessionStorage.PESO_USUARIO)
        var altura = parseFloat(sessionStorage.ALTURA_USUARIO)
        var img = ""


        if (peso > 0 && altura > 0) {
            posição = `Running Back`
            img = `<img src="../assets/runningback_icon.jpg">`

            if (peso > 75 && altura > 1.75) {
                posição = `Corner Back`
                img = `<img src="../assets/cornerback_icon.jpg">`

                if (peso > 80 && altura > 1.80) {
                    posição = `Wide Receiver`
                    img = `<img src="../assets/widereceiver_icon.jpg">`
                    if (peso > 100 && altura > 1.82) {
                        posição = `Linebacker`
                        img = `<img src="../assets/linebacker_icon.jpeg">`

                        if (peso > 104 && altura > 1.83) {
                            posição = `Quarter back`
                            img = `<img src="../assets/quarterback_icon.jpeg">`

                            if (peso > 106 && altura > 1.85) {
                                posição = `Tight end`
                                img = `<img src="../assets/tightend_icon.jpg">`
                                if (peso > 115 && altura > 1.87) {
                                    posição = `Defensive Lineman`
                                    img = `<img src="../assets/defensivelineman_icon.jpeg">`
                                    if (peso > 125 && altura > 1.90) {
                                        posição = `Offensive Lineman`
                                        img = `<img src="../assets/ofensivelineman_icon.jpeg">`

                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        img_usuario.innerHTML += img
        p_posicao.innerHTML = posição

    }


    function obterDadosGraficoMetricasCadastradas() {
        var resposta_metricas
        var idUsuario = sessionStorage.ID_USUARIO
        var resposta_acompanhamento1 
        var resposta_acompanhamento2
        var resposta_acompanhamento3 
        var resposta_acompanhamento4
        var resposta_acompanhamento5 
        var resposta_acompanhamento6
          




        fetch(`/medidas/MetricasCadastradas/${idUsuario}`, {
                cache: 'no-store'
            }).then(function(response) {
                if (response.ok) {
                    response.json().then(function(resposta) {
                        resposta.reverse();

                        resposta_metricas = resposta[0]
                         if (( resposta_acompanhamento1 != undefined  || resposta_acompanhamento2 != undefined ||
                                resposta_acompanhamento3 != undefined || resposta_acompanhamento4 != undefined ||
                                resposta_acompanhamento5 != undefined || resposta_acompanhamento6 != undefined
                            ) && resposta_metricas != undefined) {
                                plotar_grafico(resposta_acompanhamento1, resposta_acompanhamento2, resposta_acompanhamento3,
                                resposta_acompanhamento4, resposta_acompanhamento5,resposta_acompanhamento6 , resposta_metricas)
                            }

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function(error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

      

        fetch(`/medidas/ultimas/${idUsuario}`, {
                cache: 'no-store'
            }).then(function(response) {
                if (response.ok) {
                    response.json().then(function(resposta) {
                        resposta.reverse();

                        for(i = 0; i <6; i ++ ){
                            if(resposta[i] == undefined) {
                                resposta[i] = resposta[i] = {mes: null, metrica_tiro40y: null};  
                            }
                            
                        }


                        var ordenamento_mes = [[], [], [], [], [], []]

                    
                            for(i = 0; i< 6; i++) {
                                var momento_lista = resposta[i]
                                if(resposta[i].mes != null) {

                                    if(resposta[i].mes == 1) {
                                        ordenamento_mes[0].push(resposta[i])
                                    }


                                    if(resposta[i].mes == 2) {
                                        ordenamento_mes[1].push(resposta[i])
                                    }


                                    if(resposta[i].mes == 3) {
                                        ordenamento_mes[2].push(resposta[i])
                                    }


                                    if(resposta[i].mes == 4) {
                                        ordenamento_mes[3].push(resposta[i])
                                    }

                                    if(resposta[i].mes == 5) {
                                        ordenamento_mes[4].push(resposta[i])
                                    }


                                    if(resposta[i].mes == 6) {
                                        ordenamento_mes[5].push(resposta[i])
                                    }
                                }

                            } 

                            if(ordenamento_mes[0].length == 0) {
                                ordenamento_mes[0].push({mes: null, metrica_tiro40y: null})
                                resposta_acompanhamento1 = ordenamento_mes[0][0]
                            } else {
                                resposta_acompanhamento1 =  ordenamento_mes[0][0]
                            }

                            if(ordenamento_mes[1].length == 0) {
                                ordenamento_mes[1].push({mes: null, metrica_tiro40y: null})
                                resposta_acompanhamento2 = ordenamento_mes[1][0]
                            } else {
                                resposta_acompanhamento2 =  ordenamento_mes[1][0]
                            }

                            if(ordenamento_mes[2].length == 0) {
                                ordenamento_mes[2].push({mes: null, metrica_tiro40y: null})
                                resposta_acompanhamento3 = ordenamento_mes[2][0]
                            } else {
                                resposta_acompanhamento3 =  ordenamento_mes[2][0]
                            }

                        
                            if(ordenamento_mes[3].length == 0) {
                                ordenamento_mes[3].push({mes: null, metrica_tiro40y: null})
                                resposta_acompanhamento4 = ordenamento_mes[3][0]
                            } else {
                                resposta_acompanhamento4 =  ordenamento_mes[3][0]
                            }


                            if(ordenamento_mes[4].length == 0) {
                                ordenamento_mes[4].push({mes: null, metrica_tiro40y: null})
                                resposta_acompanhamento5 = ordenamento_mes[4][0]
                            } else {
                                resposta_acompanhamento5 =  ordenamento_mes[4][0]
                            }


                            if(ordenamento_mes[5].length == 0) {
                                ordenamento_mes[5].push({mes: null, metrica_tiro40y: null})
                                resposta_acompanhamento6 = ordenamento_mes[5][0]
                            } else {
                                resposta_acompanhamento6 =  ordenamento_mes[5][0]
                            }      
                        

        

                            if (( resposta_acompanhamento1 != undefined  || resposta_acompanhamento2 != undefined ||
                                resposta_acompanhamento3 != undefined || resposta_acompanhamento4 != undefined ||
                                resposta_acompanhamento5 != undefined || resposta_acompanhamento6 != undefined
                            ) && resposta_metricas != undefined) {
                                plotar_grafico(resposta_acompanhamento1, resposta_acompanhamento2, resposta_acompanhamento3,
                                resposta_acompanhamento4, resposta_acompanhamento5,resposta_acompanhamento6 , resposta_metricas)
                            }
                        
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function(error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }



    function plotar_grafico(resposta_acompanhamento1, resposta_acompanhamento2, resposta_acompanhamento3,
                                resposta_acompanhamento4, resposta_acompanhamento5,resposta_acompanhamento6 , resposta_metricas) {


        var idUsuario = sessionStorage.ID_USUARIO
                                             


        var metrica_cadastrado1 = parseFloat( resposta_acompanhamento1.metrica_tiro40y)
        var metrica_cadastrado2 = parseFloat(resposta_acompanhamento2.metrica_tiro40y)
        var metrica_cadastrado3 = parseFloat(resposta_acompanhamento3.metrica_tiro40y)
       var metrica_cadastrado4 = parseFloat(resposta_acompanhamento4.metrica_tiro40y)
        var metrica_cadastrado5 = parseFloat(resposta_acompanhamento5.metrica_tiro40y)
        var metrica_cadastrado6 = parseFloat(resposta_acompanhamento6.metrica_tiro40y)  

        console.log(metrica_cadastrado4)
            
        

        var frequencia = resposta_metricas.frequencia_treino
        var mes0 =  resposta_metricas.metrica_tiro40y
        var mes1 = mes0 - (frequencia * resposta_metricas.metrica_tiro40y / 100)
        var mes2 = mes1 - (frequencia * mes1 / 100)
        var mes3 = mes2 - (frequencia * mes2 / 100)
        var mes4 = mes3 - (frequencia * mes3 / 100)
        var mes5 = mes4 - (frequencia * mes4 / 100)
        var mes7 = mes5 - (frequencia * mes5 / 100)
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        console.log(mes0)
    
        let dados = {
            labels: labels,
            labels: ['Inicio', 'Mês 1', 'Mês 2', 'Mês 3', 'Mês 4', 'Mês 5', 'Mês 6'],
            datasets: [{
                    label: 'Projeção',
                    data: [mes0, mes1, mes2, mes3, mes4, mes5, mes7]
                },
                {
                    label: 'Em andamento',
                    data: [mes0, metrica_cadastrado1, metrica_cadastrado2, metrica_cadastrado3, metrica_cadastrado4, metrica_cadastrado5, metrica_cadastrado6]  

                }
            ]
        };



    
        const config = {
            type: 'line',
            data: dados,
        };


        let myChart = new Chart(
            document.getElementById(`myChart`),
            config
        );

     
    }


   



   
</script>